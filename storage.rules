rules_version = '2';

// Firebase Storage 보안 규칙
service firebase.storage {
  match /b/{bucket}/o {
    
    // 🔐 사용자 프로필 이미지 (회원가입 시 샵 사진 등)
    // - 모든 사용자 읽기/쓰기 가능
    match /users/{userId}/{allPaths=**} {
      allow read, write: if true;
    }
    
    // 🛍️ 상품 이미지
    // - 모든 사용자 읽기 가능 (쇼핑몰 표시용)
    // - 모든 사용자 쓰기 가능 (업로드 가능)
    match /products/{allPaths=**} {
      allow read, write: if true;
    }
    
    // 📄 공개 파일들 (로고, 배너 등)
    // - 모든 사용자 읽기/쓰기 가능
    match /public/{allPaths=**} {
      allow read, write: if true;
    }
    
    // 📝 리뷰 이미지
    // - 모든 사용자 읽기/쓰기 가능
    match /reviews/{allPaths=**} {
      allow read, write: if true;
    }
    
    // 🔧 테스트용 경로 (문제 해결을 위한 임시)
    match /test/{allPaths=**} {
      allow read, write: if true;
    }
    
    // 📢 공지사항 첨부파일 - 모든 사용자 읽기 가능, 관리자만 쓰기 가능
    match /notices/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 🤔 FAQ 첨부파일 - 모든 사용자 읽기 가능, 관리자만 쓰기 가능
    match /faq/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 📋 상품 첨부파일 (매뉴얼, 보증서) - 모든 사용자 읽기 가능, 관리자만 쓰기 가능
    match /productAttachments/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 📦 주문 관련 파일 - 인증된 사용자만 접근
    match /orders/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // 💬 고객 문의 첨부파일 - 인증된 사용자만 접근
    match /inquiries/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // 💰 환불 관련 증빙자료 - 인증된 사용자만 접근
    match /refunds/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // 🛡️ 관리자 전용 파일 - 관리자만 접근
    match /admin/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // 💾 백업 파일들 - 관리자만 접근
    match /backups/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // ⚙️ 설정 관련 파일 - 관리자만 접근
    match /settings/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // 📊 분석 데이터 파일 - 관리자만 접근
    match /analytics/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // 📝 시스템 로그 파일 - 관리자만 접근
    match /logs/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // ⏳ 임시 파일 (업로드 중, 캐시) - 모든 사용자 읽기/쓰기 가능
    match /temp/{allPaths=**} {
      allow read, write: if true;
    }
    
    // ============== 가격 보호 및 보안 관련 파일 ==============
    
    // 💰 가격 관련 이미지/파일 (로그인 사용자만)
    match /pricing/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // 🔒 가격 워터마크 이미지 (로그인 유도용)
    match /priceProtection/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 📊 사용자 활동 로그 파일 (관리자만)
    match /activityLogs/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if true; // 로그 자동 생성용
    }
    
    // 🔍 검색 관련 파일 (키워드 매핑, 결과 캐시)
    match /searchData/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if true; // 검색 결과 캐싱용
    }
    
    // 👤 게스트 세션 파일 (임시 데이터)
    match /guestData/{allPaths=**} {
      allow read, write: if true;
    }
    
    // 📈 변환 추적 이미지 (분석용)
    match /conversionTracking/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 🧪 A/B 테스트 리소스
    match /abTestAssets/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 🗺️ 히트맵 이미지 (클릭/조회 분석)
    match /heatmaps/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 🚨 보안 이벤트 스크린샷 (의심스러운 활동)
    match /securityEvents/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 📱 모바일 전용 가격 표시 이미지
    match /mobilePricing/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // 🎯 사용자 세그먼트 관련 리소스
    match /userSegments/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // 📊 실시간 대시보드 차트 이미지
    match /realtimeCharts/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 🔍 검색 자동완성 데이터 파일
    match /autocomplete/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 🏷️ 가격 태그 템플릿 이미지
    match /priceTags/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
  }
}